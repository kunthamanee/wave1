<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pixel Wave Defender ‚Äî 70/30 Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  :root{--bg:#061226;--panel:#0b2030;--accent:#ffd755;--accent2:#55ddff;}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#031229,#021018);
    font-family:"Press Start 2P", monospace; color:#fff}
  .wrap{display:flex;flex-direction:column;align-items:center;padding:12px;gap:8px;}
  canvas{background:linear-gradient(180deg,#02101a,#011018);image-rendering:pixelated;
    border:6px solid #07263a;box-shadow:0 8px 40px rgba(0,0,0,0.6);border-radius:8px;}
  .hud{display:flex;gap:12px;align-items:center;font-size:11px;text-shadow:0 0 6px rgba(0,0,0,0.6)}
  .hud .box{background:rgba(0,0,0,0.35);padding:8px 10px;border-radius:6px;border:2px solid rgba(255,255,255,0.03)}
  .controls{margin-top:8px;width:360px;max-width:92%;display:flex;gap:6px;justify-content:center;flex-wrap:wrap}
  .btn{background:linear-gradient(180deg,#ffd77f,#ffb84d);border:3px solid #4d2b00;
    padding:8px 10px;border-radius:6px;font-size:11px;cursor:pointer;box-shadow:0 6px 0 #8a5a0a;}
  .choiceBtn{background:linear-gradient(180deg,#6fe6ff,#38b0d7);color:#02121b;
    border:3px solid #05323b;padding:6px 8px;font-size:10px;border-radius:6px;box-shadow:0 6px 0 #034d57;}
  .choiceBtn.correct{background:linear-gradient(180deg,#9df59a,#51c65d);box-shadow:0 6px 0 #2b8a2f;}
  .choiceBtn.wrong{background:linear-gradient(180deg,#ff9aa0,#ff5968);box-shadow:0 6px 0 #8a2b3a;}
  .overlay{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:60;
    background:linear-gradient(180deg,#021825,#041833);padding:16px;border-radius:10px;
    width:92%;max-width:760px;border:4px solid rgba(255,255,255,0.03)}
  .title{font-size:14px;color:var(--accent);text-align:center;margin-bottom:6px}
  .sub{font-size:10px;color:#bcd;text-align:center;margin-bottom:10px}
  .questionBox{background:#021827;padding:10px;border-radius:6px;border:2px solid rgba(255,255,255,0.03);
    margin-bottom:8px;font-size:11px;color:#ffd}
  footer{font-size:10px;color:#89b;margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="hud">
    <div class="box">SCORE: <span id="score">0</span></div>
    <div class="box">LIVES: <span id="lives">5</span></div>
    <div class="box">TIME LEFT: <span id="globalTimer">05:00</span></div>
    <div class="box">Q TIME: <span id="questionTimer">15</span>s</div>
    <div class="box">ENEMY: <span id="enemyName">‚Äî</span></div>
  </div>

  <canvas id="game" width="360" height="640"></canvas>
  <div class="controls" id="controls"></div>

  <div style="margin-top:6px">
    <button class="btn" id="startBtn">‚ñ∂Ô∏è START (5 ‡∏ô‡∏≤‡∏ó‡∏µ)</button>
    <button class="btn" id="pauseBtn">‚è∏Ô∏è PAUSE</button>
    <button class="btn" id="helpBtn">‚ùì HELP</button>
  </div>

  <footer>Pixel Monsters ‚Ä¢ Œª = v/f 70% | ‡∏ó‡∏§‡∏©‡∏é‡∏µ 30% ‚Ä¢ 15s/‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‚Ä¢ 5 ‡∏ô‡∏≤‡∏ó‡∏µ</footer>
</div>

<div id="overlayRoot" style="position:fixed;left:0;top:0;right:0;bottom:0;display:none;
  align-items:center;justify-content:center;z-index:70"></div>

<script>
/* --------------------------
   CONFIG
   -------------------------- */
const canvas = document.getElementById('game'), ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

// state
let state = {
  running:false, score:0, lives:5, anim:0,
  currentEnemy:null, awaitingAnswer:false,
  globalTime:300, questionTime:15,
  correctCount:0, wrongCount:0, unansweredCount:0,
  encounteredQuestions:[]
};

// easy numbers
const easyF = [2,4,5,10,20];
const easyV = [40,50,100,200];
const monsters = [
  {name:'Plasma Fiend üëæ',color:'#ff5d5d',boss:false,points:80},
  {name:'Neon Squid ü¶ë',color:'#6bf5ff',boss:false,points:70},
  {name:'Ember Wyrm üî•',color:'#ffb86b',boss:false,points:75},
  {name:'Void Eye üëπ',color:'#b86bff',boss:false,points:85},
  {name:'Star Titan üëë',color:'#4bff9e',boss:true,points:200}
];
const theoryQ = [
  {q:'‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà (frequency) ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏≠‡∏∞‡πÑ‡∏£?',c:[
    '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏ô‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ','‡∏£‡∏∞‡∏¢‡∏∞‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏¢‡∏≠‡∏î‡∏Ñ‡∏•‡∏∑‡πà‡∏ô‡∏™‡∏≠‡∏á‡∏¢‡∏≠‡∏î',
    '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Ñ‡∏•‡∏∑‡πà‡∏ô','‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏•‡∏∑‡πà‡∏ô'],a:0},
  {q:'‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ñ‡∏•‡∏∑‡πà‡∏ô (wavelength) ‡∏Ñ‡∏∑‡∏≠?',c:[
    '‡∏£‡∏∞‡∏¢‡∏∞‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏∏‡∏î‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏•‡∏∑‡πà‡∏ô','‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏ô‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ',
    '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Ñ‡∏•‡∏∑‡πà‡∏ô','‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏•‡∏∑‡πà‡∏ô'],a:0},
  {q:'‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÇ‡∏î‡∏¢ v ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà Œª ‡∏à‡∏∞?',c:[
    '‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á','‡∏¢‡∏≤‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô','‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°','‡πÑ‡∏°‡πà‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå'],a:0},
  {q:'‡∏Ñ‡∏•‡∏∑‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏•‡∏∑‡πà‡∏ô‡∏ä‡∏ô‡∏¥‡∏î‡πÉ‡∏î?',c:[
    '‡∏Ñ‡∏•‡∏∑‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏¢‡∏≤‡∏ß','‡∏Ñ‡∏•‡∏∑‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏Ç‡∏ß‡∏≤‡∏á','‡∏Ñ‡∏•‡∏∑‡πà‡∏ô‡∏ô‡∏¥‡πà‡∏á','‡πÅ‡∏°‡πà‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÑ‡∏ü‡∏ü‡πâ‡∏≤'],a:0},
  {q:'‡πÅ‡∏≠‡∏°‡∏û‡∏•‡∏¥‡∏à‡∏π‡∏î (amplitude) ‡∏Ñ‡∏∑‡∏≠?',c:[
    '‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏™‡∏°‡∏î‡∏∏‡∏•','‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏ô‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ',
    '‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≠‡∏î‡∏Ñ‡∏•‡∏∑‡πà‡∏ô','‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Ñ‡∏•‡∏∑‡πà‡∏ô'],a:0}
];

/* --------------------------
   HELPERS
   -------------------------- */
function pixRect(x,y,w,h,c){ctx.fillStyle=c;ctx.fillRect(x,y,w,h);}
function drawText(t,x,y,s=8,c='#fff',a='left'){
  ctx.fillStyle=c;ctx.font=`${s}px "Press Start 2P"`;ctx.textAlign=a;ctx.fillText(t,x,y);
}
function shuffle(a){for(let i=a.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));
 [a[i],a[j]]=[a[j],a[i]]}return a}

/* --------------------------
   QUESTIONS
   -------------------------- */
function newQuestion(enemy){
  let q;
  if(Math.random()<0.7){ // 70% calc
    const f = easyF[Math.floor(Math.random()*easyF.length)];
    const v = easyV[Math.floor(Math.random()*easyV.length)];
    const lambda=v/f;
    const text=`‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Œª = v/f\nv=${v} m/s, f=${f} Hz`;
    const choices=new Set([lambda]);
    while(choices.size<4){choices.add(lambda+(Math.floor(Math.random()*5)-2));}
    const arr=shuffle([...choices]);
    q={type:'calc',text,choices:arr,correct:lambda};
  }else{ // 30% theory
    const tq=theoryQ[Math.floor(Math.random()*theoryQ.length)];
    const arr=shuffle([...tq.c]);
    q={type:'theory',text:tq.q,choices:arr,correctIndex:arr.indexOf(tq.c[tq.a])};
  }
  state.encounteredQuestions.push({enemy:enemy.name,q});
  return q;
}

/* --------------------------
   ENEMY
   -------------------------- */
function spawnEnemy(){
  const m=monsters[Math.floor(Math.random()*monsters.length)];
  state.currentEnemy={x:W/2,y:120,color:m.color,name:m.name,points:m.points,hp:m.boss?3:1};
  const q=newQuestion(state.currentEnemy);
  state.currentQuestion=q;
  state.awaitingAnswer=true;
  renderChoices(q);
  state.questionTime=15;
}

/* --------------------------
   CHOICES UI
   -------------------------- */
const controls=document.getElementById('controls');
function renderChoices(q){
  controls.innerHTML='';
  const qb=document.createElement('div');
  qb.className='questionBox';
  qb.innerText=q.text;controls.appendChild(qb);
  q.choices.forEach((c,i)=>{
    const b=document.createElement('button');b.className='choiceBtn';
    b.innerText=(q.type==='calc'?`Œª=${c} m`:c);
    b.onclick=()=>answer(q,c,i,b);controls.appendChild(b);
  });
}
function answer(q,choice,i,btn){
  if(!state.awaitingAnswer)return;
  state.awaitingAnswer=false;
  let correct=false;
  if(q.type==='calc'){correct=(choice===q.correct);}
  else{correct=(i===q.correctIndex);}
  if(correct){btn.classList.add('correct');state.score+=state.currentEnemy.points;state.correctCount++;}
  else{btn.classList.add('wrong');state.lives--;state.wrongCount++;}
  setTimeout(()=>{state.currentEnemy=null;controls.innerHTML='';if(state.lives<=0)endGame();},700);
}

/* --------------------------
   GAME LOOP
   -------------------------- */
function updateHUD(){
  document.getElementById('score').innerText=state.score;
  document.getElementById('lives').innerText=state.lives;
  document.getElementById('enemyName').innerText=state.currentEnemy?state.currentEnemy.name:'‚Äî';
  const mm=String(Math.floor(state.globalTime/60)).padStart(2,'0');
  const ss=String(state.globalTime%60).padStart(2,'0');
  document.getElementById('globalTimer').innerText=`${mm}:${ss}`;
  document.getElementById('questionTimer').innerText=state.questionTime;
}
function loop(){
  if(!state.running)return;
  ctx.fillStyle='#011022';ctx.fillRect(0,0,W,H);
  for(let i=0;i<40;i++){pixRect((i*37+state.anim)%W,(i*53+state.anim*2)%H,1,1,'#9fe6ff');}
  if(state.currentEnemy){
    const e=state.currentEnemy;
    for(let r=0;r<5;r++){pixRect(e.x-16,e.y-12+r*4,32,3,e.color);}
    pixRect(e.x-6,e.y-6,4,4,'#000');pixRect(e.x+2,e.y-6,4,4,'#000');
  }else{spawnEnemy();}
  drawText('Œª=v/f',8,14,9,'#ffd07a','left');
  state.anim++;
  updateHUD();
  requestAnimationFrame(loop);
}

/* --------------------------
   START/END
   -------------------------- */
document.getElementById('startBtn').onclick=()=>{
  state.running=true;state.score=0;state.lives=5;state.globalTime=300;
  state.correctCount=0;state.wrongCount=0;state.unansweredCount=0;
  state.encounteredQuestions=[];controls.innerHTML='';spawnEnemy();loop();
  setInterval(()=>{if(state.running){state.globalTime--;state.questionTime--;
    if(state.questionTime<=0){state.unansweredCount++;state.lives--;state.awaitingAnswer=false;state.currentEnemy=null;controls.innerHTML='';}
    if(state.globalTime<=0||state.lives<=0)endGame();updateHUD();}},1000);
};
function endGame(){
  state.running=false;
  const overlay=document.createElement('div');overlay.className='overlay';
  overlay.innerHTML=`
    <div class="title">üèÅ GAME OVER</div>
    <div class="sub">SCORE: ${state.score} | ‡∏ñ‡∏π‡∏Å: ${state.correctCount} | ‡∏ú‡∏¥‡∏î: ${state.wrongCount} | ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö: ${state.unansweredCount}</div>
    <div style="font-size:11px;color:#ffd;margin-top:8px;text-align:left">
      ‡∏™‡∏π‡∏ï‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: Œª = v / f<br>
      Œª = ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ñ‡∏•‡∏∑‡πà‡∏ô, v = ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß, f = ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà.<br>
      ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô (v ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà) ‚Üí Œª ‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á
    </div>
    <div style="margin-top:8px;font-size:10px;color:#9fe6ff">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠:</div>
    <ul style="font-size:10px;color:#fff;max-height:120px;overflow:auto">
      ${state.encounteredQuestions.slice(-6).map(q=>`<li>${q.enemy}: ${q.q.text}</li>`).join('')}
    </ul>
    <div style="margin-top:12px;text-align:center"><button class="btn" onclick="location.reload()">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà</button></div>
  `;
  document.getElementById('overlayRoot').style.display='flex';
  document.getElementById('overlayRoot').appendChild(overlay);
}
</script>
</body>
</html>
